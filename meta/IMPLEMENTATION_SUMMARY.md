# Metaæ¨¡å—é‡æ–°å®ç°æ€»ç»“

## å®ç°æ¦‚è¿°

æ ¹æ® `docs/design.md` çš„è¦æ±‚ï¼ŒMetaæ¨¡å—å·²å®Œæˆå…¨é¢é‡æ„ï¼Œå®ç°äº†æç®€åŒ–ã€é«˜æ•ˆçš„å…ƒæ•°æ®æ‰«æåŠŸèƒ½ã€‚

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### åç«¯é‡æ„

#### 1. æ•°æ®æ¨¡å‹é‡æ„
- âœ… **æ–°å¢ `schemas` è¡¨**ï¼šä½œä¸ºæ ¸å¿ƒæ‰«æå•å…ƒï¼ˆæ›¿ä»£åŸæ¥çš„ `databases`ï¼‰
- âœ… **ä¼˜åŒ– `tables` è¡¨**ï¼šç®€åŒ–å­—æ®µï¼ŒSchemaIDæ›¿ä»£DatabaseID
- âœ… **ä¼˜åŒ– `fields` è¡¨**ï¼šå®Œæ•´çš„å­—æ®µå…ƒæ•°æ®æ”¯æŒ
- âœ… **æ–°å¢ `scan_logs` è¡¨**ï¼šæ‰«æå†å²è¿½è¸ª
- âœ… **åˆ é™¤ `datasources` è¡¨**ï¼šä¸å†ç»´æŠ¤æœ¬åœ°å‰¯æœ¬

#### 2. ç›´æ¥è¯»å– system.resources
- âœ… åˆ›å»º `ResourceService`ï¼šç›´æ¥ä» `system.resources` è¡¨è¯»å–èµ„æº
- âœ… æ— æœ¬åœ°å‰¯æœ¬ï¼šéµå¾ª"å•ä¸€æ•°æ®æº"åŸåˆ™
- âœ… å®æ—¶ç»Ÿè®¡ï¼šèµ„æºæ‰«æçŠ¶æ€å®æ—¶è®¡ç®—

#### 3. ç»Ÿä¸€æ‰«ææœåŠ¡
- âœ… `ScanServiceNew`ï¼šç»Ÿä¸€çš„æ‰«ææœåŠ¡
- âœ… `AutoScanUnscanned()`ï¼šè‡ªåŠ¨æ‰«ææ‰€æœ‰æœªæ‰«æèµ„æº
- âœ… `ScanResource()`ï¼šæ‰«ææŒ‡å®šèµ„æºçš„Schema
- âœ… `scanSingleSchema()`ï¼šSchemaçº§æ‰«æï¼ˆè¡¨+å­—æ®µä¸€æ¬¡å®Œæˆï¼‰
- âœ… åˆ é™¤æ—§æœåŠ¡ï¼šç§»é™¤ `SyncService`ã€`MetadataService`

#### 4. Scanneræ¥å£å‡çº§
- âœ… æ›´æ–°æ¥å£ï¼š`ListSchemas()`, `ScanTables()`, `ScanFields()`
- âœ… PostgreSQL Scannerï¼šå®Œæ•´å®ç°
- âœ… æ”¯æŒä¸»é”®ã€å”¯ä¸€é”®ã€å­—ç¬¦é›†ç­‰å®Œæ•´å…ƒæ•°æ®

#### 5. ç®€åŒ–APIè·¯ç”±
- âœ… åªä¿ç•™5ä¸ªæ ¸å¿ƒç«¯ç‚¹ï¼š
  - `GET /api/meta/resources` - è·å–èµ„æºåŠç»Ÿè®¡
  - `GET /api/meta/schemas/:resource_id` - è·å–Schemaåˆ—è¡¨
  - `GET /api/meta/schemas/:resource_id/available` - åˆ—å‡ºå¯ç”¨Schema
  - `POST /api/meta/scan/auto` - è‡ªåŠ¨æ‰«æ
  - `POST /api/meta/scan/resource` - æ‰«ææŒ‡å®šèµ„æº
- âœ… åˆ é™¤æ—§APIï¼šç§»é™¤ `sync_handler`, `metadata_handler`

### å‰ç«¯é‡æ„

#### 6. é¡µé¢æ¸…ç†
- âœ… åˆ é™¤ `DatasourceList.vue`
- âœ… åˆ é™¤ `MetadataBrowser.vue`
- âœ… åªä¿ç•™ `MetadataScan.vue` å’Œ `Login.vue`
- âœ… ç®€åŒ–è·¯ç”±ï¼šåªæœ‰ `/scan` å’Œ `/login`

#### 7. MetadataScané‡æ„
- âœ… **å·¦å³åˆ†æ å¸ƒå±€**ï¼š
  - å·¦ä¾§ï¼šå­˜å‚¨å¼•æ“åˆ—è¡¨ï¼ˆæ˜¾ç¤ºç»Ÿè®¡ï¼‰
  - å³ä¾§ï¼šSchemaåˆ—è¡¨ï¼ˆçŠ¶æ€ã€æ“ä½œï¼‰
- âœ… **ä¸€é”®è‡ªåŠ¨æ‰«æ**ï¼šé¡¶éƒ¨æŒ‰é’®ï¼Œè‡ªåŠ¨æ‰«ææ‰€æœ‰æœªæ‰«æèµ„æº
- âœ… **æ‰¹é‡æ‰«æ**ï¼šå¤šé€‰Schemaæ‰¹é‡æ‰«æ
- âœ… **å•ä¸ªæ‰«æ**ï¼šæ¯ä¸ªSchemaç‹¬ç«‹æ‰«ææŒ‰é’®
- âœ… **çŠ¶æ€å±•ç¤º**ï¼šæœªæ‰«æ/æ‰«æä¸­/å·²æ‰«æ
- âœ… **æ‰«æè¿›åº¦å¯¹è¯æ¡†**ï¼šå®æ—¶æ˜¾ç¤ºæ‰«æç»“æœ

#### 8. APIè°ƒç”¨æ›´æ–°
- âœ… åˆ›å»ºæ–°çš„ `api/meta.js`
- âœ… å¯¹æ¥æ–°çš„åç«¯API
- âœ… é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€

## ğŸ“ æ¶æ„æ”¹è¿›

### è®¾è®¡åŸåˆ™éµå¾ª

1. âœ… **å•ä¸€èŒè´£åŸåˆ™**ï¼šMetaæ¨¡å—ä¸“æ³¨å…ƒæ•°æ®ç®¡ç†ï¼Œä¸é‡å¤SystemåŠŸèƒ½
2. âœ… **é¿å…é‡å¤ä»£ç **ï¼šä½¿ç”¨commonæ¨¡å—å…±äº«ä»£ç 
3. âœ… **å‰ç«¯å¤ç”¨åŸåˆ™**ï¼šå¯ç‹¬ç«‹éƒ¨ç½²ï¼Œä¹Ÿå¯åµŒå…¥Portal
4. âœ… **å•ä¸€æ•°æ®æº**ï¼šç›´æ¥è¯»å–system.resourcesï¼Œæ— å†—ä½™

### æ•°æ®æµç®€åŒ–

**æ—§æ¶æ„**ï¼š
```
System.resources â†’ Syncåˆ°Meta.datasources â†’ æ‰«æ â†’ databases â†’ tables â†’ fields
```

**æ–°æ¶æ„**ï¼š
```
System.resourcesï¼ˆç›´æ¥è¯»å–ï¼‰â†’ æ‰«æ â†’ schemas â†’ tables â†’ fields
```

### æ ¸å¿ƒæ”¹è¿›

1. **Schemaæ˜¯æ‰«æå•å…ƒ**ï¼šä¸æ˜¯Databaseï¼Œè€Œæ˜¯Schemaï¼ˆPostgreSQLï¼‰æˆ–Databaseï¼ˆMySQLï¼‰
2. **ä¸€æ¬¡æ€§æ‰«æ**ï¼šè¡¨+å­—æ®µä¸€æ¬¡æ‰«æå®Œæˆï¼Œä¸åˆ†å±‚çº§
3. **æ™ºèƒ½è‡ªåŠ¨æ‰«æ**ï¼šè‡ªåŠ¨å‘ç°æœªæ‰«æèµ„æº
4. **æç®€UI**ï¼šä¸€ä¸ªé¡µé¢å®Œæˆæ‰€æœ‰æ“ä½œ

## ğŸ—‚ï¸ æ–‡ä»¶å˜æ›´æ¸…å•

### æ–°å¢æ–‡ä»¶

#### åç«¯
- `internal/models/schema.go` - Schemaæ¨¡å‹
- `internal/models/scan_log.go` - æ‰«ææ—¥å¿—æ¨¡å‹
- `internal/service/resource_service.go` - èµ„æºæœåŠ¡
- `internal/service/scan_service_new.go` - æ–°æ‰«ææœåŠ¡
- `internal/api/handler.go` - ç»Ÿä¸€Handler
- `internal/api/router_new.go` - æ–°è·¯ç”±

#### å‰ç«¯
- æ— æ–°å¢ï¼Œåªæœ‰ä¿®æ”¹

### ä¿®æ”¹æ–‡ä»¶

#### åç«¯
- `internal/models/table.go` - ç®€åŒ–è¡¨æ¨¡å‹
- `internal/models/field.go` - ä¼˜åŒ–å­—æ®µæ¨¡å‹
- `internal/models/dto.go` - æ–°DTOå®šä¹‰
- `internal/scanner/types.go` - Scanneræ¥å£æ›´æ–°
- `internal/scanner/postgres_scanner.go` - PostgreSQLæ‰«æå™¨å®ç°
- `internal/repository/database.go` - æ›´æ–°AutoMigrate
- `cmd/server/main.go` - ä½¿ç”¨æ–°è·¯ç”±

#### å‰ç«¯
- `src/router/index.js` - ç®€åŒ–è·¯ç”±
- `src/api/meta.js` - æ–°APIè°ƒç”¨
- `src/views/MetadataScan.vue` - å®Œå…¨é‡æ„

### åˆ é™¤æ–‡ä»¶

#### åç«¯
- `internal/models/datasource.go` âŒ
- `internal/models/database.go` âŒ
- `internal/models/sync_log.go` âŒï¼ˆæ›¿æ¢ä¸ºscan_log.goï¼‰
- `internal/service/sync_service.go` âŒ
- `internal/service/metadata_service.go` âŒ
- `internal/service/scan_service.go` âŒï¼ˆæ›¿æ¢ä¸ºscan_service_new.goï¼‰
- `internal/api/sync_handler.go` âŒ
- `internal/api/metadata_handler.go` âŒ

#### å‰ç«¯
- `src/views/DatasourceList.vue` âŒ
- `src/views/MetadataBrowser.vue` âŒ

## ğŸ¨ ç”¨æˆ·ç•Œé¢

### å…ƒæ•°æ®æ‰«æé¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…ƒæ•°æ®æ‰«æ              [ä¸€é”®æ‰«ææœªæ‰«æèµ„æº]                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å­˜å‚¨å¼•æ“åˆ—è¡¨              â”‚  Schemaåˆ—è¡¨ - PostgreSQL-ç”Ÿäº§   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PostgreSQL-ç”Ÿäº§     â”‚   â”‚  â”‚ â˜ public                 â”‚  â”‚
â”‚  â”‚ ç±»å‹: postgresql    â”‚   â”‚  â”‚   çŠ¶æ€: æœªæ‰«æ            â”‚  â”‚
â”‚  â”‚ æ€»æ•°: 5             â”‚   â”‚  â”‚   è¡¨æ•°é‡: 0              â”‚  â”‚
â”‚  â”‚ å·²æ‰«: 2             â”‚   â”‚  â”‚   [æ‰«æ]                 â”‚  â”‚
â”‚  â”‚ æœªæ‰«: 3             â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚  â”‚ â˜‘ metadata               â”‚  â”‚
â”‚  â”‚ MySQL-æµ‹è¯•          â”‚   â”‚  â”‚   çŠ¶æ€: å·²æ‰«æ            â”‚  â”‚
â”‚  â”‚ ...                 â”‚   â”‚  â”‚   è¡¨æ•°é‡: 15             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚   ä¸Šæ¬¡: 2hå‰              â”‚  â”‚
â”‚                            â”‚  â”‚   [é‡æ–°æ‰«æ]             â”‚  â”‚
â”‚                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚  [æ‰¹é‡æ‰«æé€‰ä¸­Schema (2)]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¼€å‘æ¨¡å¼

```bash
# åç«¯
cd meta/backend
go run cmd/server/main.go

# å‰ç«¯
cd meta/frontend
npm install
npm run dev

# è®¿é—® http://localhost:5175
```

### Dockeréƒ¨ç½²

```bash
# ä»é¡¹ç›®æ ¹ç›®å½•
make up-full  # å¯åŠ¨æ‰€æœ‰æœåŠ¡åŒ…æ‹¬Meta
```

## ğŸ“Š ä¸è®¾è®¡æ–‡æ¡£å¯¹ç…§

| è®¾è®¡è¦æ±‚ | å®ç°çŠ¶æ€ |
|---------|---------|
| åªä¿ç•™"å…ƒæ•°æ®æ‰«æ"ä¸€ä¸ªå‰ç«¯é¡µé¢ | âœ… å·²å®ç° |
| è‡ªåŠ¨åˆ¤æ–­æœªæ‰«æèµ„æº | âœ… å·²å®ç° |
| åˆ—å‡ºæ‰€æœ‰å­˜å‚¨å¼•æ“ | âœ… å·²å®ç° |
| é€‰æ‹©Schemaå¹¶æ‰«æ | âœ… å·²å®ç° |
| æ‰«æè¡¨+å­—æ®µ | âœ… å·²å®ç° |
| çŠ¶æ€ç®¡ç†ï¼ˆæœªæ‰«æ/æ‰«æä¸­/å·²æ‰«æï¼‰ | âœ… å·²å®ç° |
| å®šæ—¶è‡ªåŠ¨æ‰«æ | â³ é¢„ç•™æ¥å£ï¼ˆéœ€åœ¨main.goä¸­å®ç°cronï¼‰ |
| å·¦å³åˆ†æ å¸ƒå±€ | âœ… å·²å®ç° |
| ç›´æ¥è¯»å–system.resources | âœ… å·²å®ç° |

## ğŸ”§ å¾…å®Œæˆï¼ˆå¯é€‰ï¼‰

1. **å®šæ—¶ä»»åŠ¡è°ƒåº¦**ï¼šåœ¨ `main.go` ä¸­æ·»åŠ cronè°ƒåº¦å™¨
2. **MySQL Scannerå®Œæ•´å®ç°**ï¼šå½“å‰åªå®ç°äº†PostgreSQL
3. **æ‰«ææ·±åº¦é…ç½®**ï¼šbasic/deep/fullçš„å…·ä½“å®ç°
4. **Schemaçº§å®šæ—¶é…ç½®**ï¼šæ¯ä¸ªSchemaç‹¬ç«‹çš„cronè®¾ç½®

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **é¦–æ¬¡ä½¿ç”¨**ï¼šç‚¹å‡»"ä¸€é”®æ‰«ææœªæ‰«æèµ„æº"ï¼Œè‡ªåŠ¨æ‰«ææ‰€æœ‰æ•°æ®æº
2. **æ—¥å¸¸ä½¿ç”¨**ï¼šé€‰æ‹©ç‰¹å®šèµ„æºï¼Œæ‰«æå…¶ä¸­çš„Schema
3. **æ‰¹é‡æ“ä½œ**ï¼šå¤šé€‰Schemaåæ‰¹é‡æ‰«æ
4. **å¢é‡æ›´æ–°**ï¼šå·²æ‰«æçš„Schemaç‚¹å‡»"é‡æ–°æ‰«æ"æ›´æ–°å…ƒæ•°æ®

## ğŸ“ æ³¨æ„äº‹é¡¹

1. ç¡®ä¿Systemæ¨¡å—æ­£å¸¸è¿è¡Œï¼ˆMetaä¾èµ–Systemçš„è®¤è¯å’Œèµ„æºç®¡ç†ï¼‰
2. ç¡®ä¿PostgreSQLæ•°æ®åº“ä¸­å·²åˆ›å»ºmetadata schema
3. æ‰«æå¤§å‹æ•°æ®åº“å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…
4. æ‰«æè¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨åˆ›å»º/æ›´æ–°å…ƒæ•°æ®è®°å½•

---

**å®ç°æ—¥æœŸ**: 2025-10-06
**å®ç°è€…**: Claude Code
**åŸºäºè®¾è®¡**: docs/design.md
